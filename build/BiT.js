var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);var RayCaster$$module$src$modules$raycaster=function(){this.cameraX;this.rayDirX;this.rayDirY;this.mapX;this.mapY;this.deltaDistX;this.deltaDistY;this.sideDistX;this.sideDistY;this.perpWallDist;this.stepX;this.stepY;this.hit;this.side;this.lineHeight;this.drawStart;this.drawEnd;this.color};
RayCaster$$module$src$modules$raycaster.prototype.CastRay=function(a,b,c,d){this.hit=0;this.cameraX=2*a/d.width-1;this.rayDirX=c.dirX+c.planeX*this.cameraX;this.rayDirY=c.dirY+c.planeY*this.cameraX;this.mapX=Math.floor(c.posX);this.mapY=Math.floor(c.posY);this.deltaDistX=Math.abs(1/this.rayDirX);this.deltaDistY=Math.abs(1/this.rayDirY);0>this.rayDirX?(this.stepX=-1,this.sideDistX=(c.posX-this.mapX)*this.deltaDistX):(this.stepX=1,this.sideDistX=(this.mapX+1-c.posX)*this.deltaDistX);0>this.rayDirY?
(this.stepY=-1,this.sideDistY=(c.posY-this.mapY)*this.deltaDistY):(this.stepY=1,this.sideDistY=(this.mapY+1-c.posY)*this.deltaDistY);for(;0==this.hit;)this.sideDistX<this.sideDistY?(this.sideDistX+=this.deltaDistX,this.mapX+=this.stepX,this.side=0):(this.sideDistY+=this.deltaDistY,this.mapY+=this.stepY,this.side=1),0<b[this.mapX][this.mapY]&&(this.hit=1);this.perpWallDist=0==this.side?(this.mapX-c.posX+(1-this.stepX)/2)/this.rayDirX:(this.mapY-c.posY+(1-this.stepY)/2)/this.rayDirY;this.lineHeight=
Math.floor(d.height/this.perpWallDist);this.drawStart=Math.floor(-this.lineHeight/2+d.height/2);0>this.drawStart&&(this.drawStart=0);this.drawEnd=Math.floor(this.lineHeight/2+d.height/2);this.drawEnd>=d.height&&(this.drawEnd=d.height-1);switch(b[this.mapX][this.mapY]){case 1:this.color=0==this.side?"#880000":"#FF7777";break;case 2:this.color=0==this.side?"#0000AA":"#0088FF";break;case 3:this.color=0==this.side?"#00CC55":"#AAFF66";break;case 4:this.color=0==this.side?"#664400":"#DD8855";break;case 5:this.color=
0==this.side?"#333333":"#000000"}return{start:this.drawStart,end:this.drawEnd,color:this.color}};var module$src$modules$raycaster={};module$src$modules$raycaster.RayCaster=RayCaster$$module$src$modules$raycaster;var Player$$module$src$modules$player=function(){this.posX=21;this.posY=12;this.dirX=-1;this.planeX=this.dirY=0;this.planeY=.66;this.rot=0;this.turn=this.right=this.left=this.backward=this.forward=!1;this.collision=15},module$src$modules$player={};module$src$modules$player.Player=Player$$module$src$modules$player;var Map$$module$src$modules$map=function(){this.data=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,2,2,2,2,2,0,0,0,0,3,0,3,0,3,0,0,0,1],[1,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,2,0,0,0,2,0,0,0,0,3,0,0,0,3,0,0,0,1],[1,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,2,2,0,2,2,0,0,0,0,3,0,3,0,3,0,0,0,
1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,4,0,4,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,4,0,0,0,0,5,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
[1,4,0,4,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,4,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]};$jscomp.global.Object.defineProperties(Map$$module$src$modules$map.prototype,{map:{configurable:!0,enumerable:!0,get:function(){return this.data}}});var module$src$modules$map={};module$src$modules$map.Map=Map$$module$src$modules$map;var Engine$$module$src$modules$engine=function(){var a=this;this.updateRotation=this.updateRotation.bind(this);this.rayCaster=new RayCaster$$module$src$modules$raycaster;this.player=new Player$$module$src$modules$player;this.map=(new Map$$module$src$modules$map).map;this.canv=document.createElement("canvas");this.canv.width=window.innerWidth;this.canv.height=window.innerHeight;this.canv.style.width="100%";this.canv.style.imageRendering="pixelated";this.canv.addEventListener("touchend",function(b){a.touched=
!1;a.oldTouchDX=0;a.oldTouchDY=0;a.touchDX=0;a.touchDY=0;a.player.rot=0;a.player.forward=!1;a.player.backward=!1});this.canv.addEventListener("touchmove",function(b){a.touched&&(a.touchDX=-.1*(a.oldTouchDX-b.touches[0].clientX),a.touchDY=a.oldTouchDY-b.touches[0].clientY,0!=a.touchDY&&(a.player.forward=!0))},{passive:!1});this.canv.addEventListener("touchstart",function(b){a.touched=!0;a.oldTouchDX=b.touches[0].clientX;a.oldTouchDY=b.touches[0].clientY},{passive:!1});document.body.appendChild(this.canv);
this.canv.onclick=function(){a.canv.requestPointerLock()};this.mouseLocked=!1;this.ctx=this.canv.getContext("2d",{alpha:!1});this.ctx.lineWidth=1;this.oldRot=this.oldTime=0;this.touched=!1;this.movSpeed=this.touchDY=this.touchDX=this.oldTouchDY=this.oldTouchDX=0;this.superSpeed=1;document.addEventListener("pointerlockchange",function(){document.pointerLockElement==a.canv?(console.log("The pointer lock status is now locked"),document.addEventListener("mousemove",a.updateRotation,!1)):(console.log("The pointer lock status is now unlocked"),
document.removeEventListener("mousemove",a.updateRotation,!1))},!1);document.addEventListener("keyup",function(b){switch(b.keyCode){case 87:a.player.forward=!1;break;case 83:a.player.backward=!1;break;case 65:a.player.left=!1;break;case 68:a.player.right=!1;break;case 16:a.superSpeed=1}},!1);document.addEventListener("keydown",function(b){switch(b.keyCode){case 87:a.player.forward=!0;break;case 83:a.player.backward=!0;break;case 65:a.player.left=!0;break;case 68:a.player.right=!0;break;case 16:a.superSpeed=
2.5}},!1)};Engine$$module$src$modules$engine.prototype.updateRotation=function(a){this.player.rot=a.movementX};
Engine$$module$src$modules$engine.prototype.update=function(a){var b=(a-this.oldTime)/1E3;this.movSpeed=3*b*this.superSpeed;if(1==this.touched||this.player.rot!=this.oldRot){if(this.touched){var c=this.touchDX;this.movSpeed=this.touchDY/1E3}else c=(this.oldRot+this.player.rot)/2;this.oldRot=this.player.rot;b=c*b*-.1;c=this.player.dirX;this.player.dirX=this.player.dirX*Math.cos(b)-this.player.dirY*Math.sin(b);this.player.dirY=c*Math.sin(b)+this.player.dirY*Math.cos(b);c=this.player.planeX;this.player.planeX=
this.player.planeX*Math.cos(b)-this.player.planeY*Math.sin(b);this.player.planeY=c*Math.sin(b)+this.player.planeY*Math.cos(b)}this.player.forward&&(0==this.map[Math.floor(this.player.posX+this.player.dirX*this.movSpeed*this.player.collision)][Math.floor(this.player.posY)]&&(this.player.posX+=this.player.dirX*this.movSpeed),0==this.map[Math.floor(this.player.posX)][Math.floor(this.player.posY+this.player.dirY*this.movSpeed*this.player.collision)]&&(this.player.posY+=this.player.dirY*this.movSpeed));
this.player.right&&(b=(this.player.dirX*Math.cos(Math.PI/2)-this.player.dirY*Math.sin(Math.PI/2))*this.movSpeed,0==this.map[Math.floor(this.player.posX-b*this.player.collision)][Math.floor(this.player.posY)]&&(this.player.posX-=b),b=(this.player.dirX*Math.sin(Math.PI/2)+this.player.dirY*Math.cos(Math.PI/2))*this.movSpeed,0==this.map[Math.floor(this.player.posX)][Math.floor(this.player.posY-b*this.player.collision)]&&(this.player.posY-=b));this.player.left&&(b=(this.player.dirX*Math.cos(-Math.PI/2)-
this.player.dirY*Math.sin(-Math.PI/2))*this.movSpeed,0==this.map[Math.floor(this.player.posX-b*this.player.collision)][Math.floor(this.player.posY)]&&(this.player.posX-=b),b=(this.player.dirX*Math.sin(-Math.PI/2)+this.player.dirY*Math.cos(-Math.PI/2))*this.movSpeed,0==this.map[Math.floor(this.player.posX)][Math.floor(this.player.posY-b*this.player.collision)]&&(this.player.posY-=b));this.player.backward&&(0==this.map[Math.floor(this.player.posX-this.player.dirX*this.movSpeed*this.player.collision)][Math.floor(this.player.posY)]&&
(this.player.posX-=this.player.dirX*this.movSpeed),0==this.map[Math.floor(this.player.posX)][Math.floor(this.player.posY-this.player.dirY*this.movSpeed*this.player.collision)]&&(this.player.posY-=this.player.dirY*this.movSpeed));this.oldTime=a};
Engine$$module$src$modules$engine.prototype.render=function(){this.ctx.fillStyle="#777777";this.ctx.fillRect(0,0,this.canv.width,this.canv.height/2);this.ctx.fillStyle="#bbbbbb";this.ctx.fillRect(0,this.canv.height/2,this.canv.width,this.canv.height);for(var a=0;a<this.canv.width;a+=1){var b=this.rayCaster.CastRay(a,this.map,this.player,this.canv);this.ctx.strokeStyle=b.color;this.ctx.beginPath();this.ctx.moveTo(a+.5,b.start);this.ctx.lineTo(a+.5,b.end);this.ctx.stroke()}};
var module$src$modules$engine={};module$src$modules$engine.Engine=Engine$$module$src$modules$engine;var game$$module$src$app=new Engine$$module$src$modules$engine,gameStep$$module$src$app=function(a){game$$module$src$app.update(a);game$$module$src$app.render();window.requestAnimationFrame(gameStep$$module$src$app)};window.requestAnimationFrame(gameStep$$module$src$app);var module$src$app={};
