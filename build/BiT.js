'use strict';class Player$$module$src$modules$player{constructor(){this.posX=11;this.posY=5;this.dirX=-1;this.planeX=this.dirY=0;this.planeY=.66;this.rot=0;this.turn=this.right=this.left=this.backward=this.forward=!1;this.collision=15}}var module$src$modules$player={};module$src$modules$player.Player=Player$$module$src$modules$player;class Map$$module$src$modules$map{constructor(){this.data=[[8,8,8,8,8,8,8,8,8,8,8,4,4,6,4,4,6,4,6,4,4,4,6,4],[8,0,0,0,0,0,0,0,0,0,8,4,0,0,0,0,0,0,0,0,0,0,0,4],[8,0,3,3,0,0,0,0,0,8,8,4,0,0,0,0,0,0,0,0,0,0,0,6],[8,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6],[8,0,3,3,0,0,0,0,0,8,8,4,0,0,0,0,0,0,0,0,0,0,0,4],[8,0,0,0,0,0,0,0,0,0,8,4,0,0,0,0,0,6,6,6,0,6,4,6],[8,8,8,8,0,8,8,8,8,8,8,4,4,4,4,4,4,6,0,0,0,0,0,6],[7,7,7,7,0,7,7,7,7,0,8,0,8,0,8,0,8,4,0,4,0,6,0,6],[7,7,0,0,0,0,0,0,7,8,0,8,0,8,0,8,8,6,0,0,0,
0,0,6],[7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,6,0,0,0,0,0,4],[7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,6,0,6,0,6,0,6],[7,7,0,0,0,0,0,0,7,8,0,8,0,8,0,8,8,6,4,6,0,6,6,6],[7,7,7,7,0,7,7,7,7,8,8,4,0,6,8,4,8,3,3,3,0,3,3,3],[2,2,2,2,0,2,2,2,2,4,6,4,0,0,6,0,6,3,0,0,0,0,0,3],[2,2,0,0,0,0,0,2,2,4,0,0,0,0,0,0,4,3,0,0,0,0,0,3],[2,0,0,0,0,0,0,0,2,4,0,0,0,0,0,0,4,3,0,0,0,0,0,3],[1,0,0,0,0,0,0,0,1,4,4,4,4,4,6,0,6,3,3,0,0,0,3,3],[2,0,0,0,0,0,0,0,2,2,2,1,2,2,2,6,6,0,0,5,0,5,0,5],[2,2,0,0,0,0,0,2,2,2,0,0,0,2,2,0,5,0,5,0,0,0,
5,5],[2,0,0,0,0,0,0,0,2,0,0,0,0,0,2,5,0,5,0,5,0,5,0,5],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5],[2,0,0,0,0,0,0,0,2,0,0,0,0,0,2,5,0,5,0,5,0,5,0,5],[2,2,0,0,0,0,0,2,2,2,0,0,0,2,2,0,5,0,5,0,0,0,5,5],[2,2,2,2,1,2,2,2,2,2,2,1,2,2,2,5,5,5,5,5,5,5,5,5]]}get map(){return this.data}}var module$src$modules$map={};module$src$modules$map.Map=Map$$module$src$modules$map;class Engine$$module$src$modules$engine{constructor(){this.updateRotation=this.updateRotation.bind(this);this.res=2;this.threads=1;this.workers=[];this.player=new Player$$module$src$modules$player;this.map=(new Map$$module$src$modules$map).map;this.textures=[];this.textureAtlas=new Image;this.canv=document.createElement("canvas");this.canv.width=window.innerWidth/this.res;this.canv.height=window.innerHeight/this.res;this.canv.style.imageRendering="crisp-edges";this.canv.style.width="100vw";this.ctx=
this.canv.getContext("2d",{alpha:!1});this.ctx.imageSmoothingEnabled=!1;document.body.appendChild(this.canv);this.backBufferCanv=document.createElement("canvas");this.backBufferCanv.width=this.canv.width;this.backBufferCanv.height=this.canv.height;this.backBufferCanv.style.imageRendering="pixelated";this.backBufferCtx=this.backBufferCanv.getContext("2d",{alpha:!1});this.backBufferCtx.imageSmoothingEnabled=!1;for(let b=0;b<this.threads;b++){const a=new Worker("./raycaster.js");a.onmessage=a=>{a=new ImageData(new Uint8ClampedArray(a.data),
this.canv.width,this.canv.height);this.workers[b].ctx.putImageData(a,0,0);this.backBufferCtx.drawImage(this.workers[b].canv,0,0);this.workers[b].done=!0};const c=document.createElement("canvas");c.width=this.canv.width;c.height=this.canv.height;c.style.imageRendering="pixelated";const d=c.getContext("2d",{alpha:!0});d.imageSmoothingEnabled=!1;this.workers[b]={worker:a,canv:c,ctx:d,done:!0}}this.canv.addEventListener("touchend",b=>{this.touched=!1;this.touchDY=this.touchDX=this.oldTouchDY=this.oldTouchDX=
0;this.player.rot=0;this.player.forward=!1;this.player.backward=!1});this.canv.addEventListener("touchmove",b=>{this.touched&&(this.touchDX=-.1*(this.oldTouchDX-b.touches[0].clientX),this.touchDY=this.oldTouchDY-b.touches[0].clientY,0!=this.touchDY&&(this.player.forward=!0))},{passive:!1});this.canv.addEventListener("touchstart",b=>{this.touched=!0;this.oldTouchDX=b.touches[0].clientX;this.oldTouchDY=b.touches[0].clientY},{passive:!1});this.canv.addEventListener("click",()=>{this.canv.requestPointerLock()});
this.mouseLocked=!1;this.oldRot=this.oldTime=0;this.touched=!1;this.movSpeed=this.touchDY=this.touchDX=this.oldTouchDY=this.oldTouchDX=0;this.superSpeed=1;document.addEventListener("pointerlockchange",()=>{document.pointerLockElement==this.canv?document.addEventListener("mousemove",this.updateRotation,!1):document.removeEventListener("mousemove",this.updateRotation,!1)},!1);document.addEventListener("keyup",b=>{switch(b.keyCode){case 87:this.player.forward=!1;break;case 83:this.player.backward=!1;
break;case 65:this.player.left=!1;break;case 68:this.player.right=!1;break;case 16:this.superSpeed=1}},!1);document.addEventListener("keydown",b=>{switch(b.keyCode){case 87:this.player.forward=!0;break;case 83:this.player.backward=!0;break;case 65:this.player.left=!0;break;case 68:this.player.right=!0;break;case 16:this.superSpeed=2.5}},!1);document.getElementById("fullscreen").addEventListener("click",b=>{this.canv.requestFullscreen&&this.canv.requestFullscreen()});window.addEventListener("resize",
()=>{this.ctx.imageSmoothingEnabled=!1})}async init(){return new Promise(b=>{this.textureAtlas.addEventListener("load",async a=>{a=document.createElement("canvas");a.width=64;a.height=64;const c=a.getContext("2d");for(let b=0;9>b;b++)c.drawImage(this.textureAtlas,b%3*64,64*Math.floor(b/3),64,64,0,0,a.width,a.height),this.textures[b]=c.getImageData(0,0,a.width,a.height),c.fillStyle="rgba(0,0,0,0.35)",c.fillRect(0,0,a.width,a.height),this.textures[b+9]=c.getImageData(0,0,a.width,a.height);b()});this.textureAtlas.src=
"./textures.webp"})}updateRotation(b){this.player.rot=b.movementX}update(b){var a=(b-this.oldTime)/1E3;this.movSpeed=2*a*this.superSpeed;if(1==this.touched||this.player.rot!=this.oldRot){if(this.touched){var c=this.touchDX;this.movSpeed=this.touchDY/1E3}else c=(this.oldRot+this.player.rot)/2;this.oldRot=this.player.rot;a=c*a*-.1;c=this.player.dirX;this.player.dirX=this.player.dirX*Math.cos(a)-this.player.dirY*Math.sin(a);this.player.dirY=c*Math.sin(a)+this.player.dirY*Math.cos(a);c=this.player.planeX;
this.player.planeX=this.player.planeX*Math.cos(a)-this.player.planeY*Math.sin(a);this.player.planeY=c*Math.sin(a)+this.player.planeY*Math.cos(a)}this.player.forward&&(0==this.map[Math.floor(this.player.posX+this.player.dirX*this.movSpeed*this.player.collision)][Math.floor(this.player.posY)]&&(this.player.posX+=this.player.dirX*this.movSpeed),0==this.map[Math.floor(this.player.posX)][Math.floor(this.player.posY+this.player.dirY*this.movSpeed*this.player.collision)]&&(this.player.posY+=this.player.dirY*
this.movSpeed));this.player.right&&(a=(this.player.dirX*Math.cos(Math.PI/2)-this.player.dirY*Math.sin(Math.PI/2))*this.movSpeed,0==this.map[Math.floor(this.player.posX-a*this.player.collision)][Math.floor(this.player.posY)]&&(this.player.posX-=a),a=(this.player.dirX*Math.sin(Math.PI/2)+this.player.dirY*Math.cos(Math.PI/2))*this.movSpeed,0==this.map[Math.floor(this.player.posX)][Math.floor(this.player.posY-a*this.player.collision)]&&(this.player.posY-=a));this.player.left&&(a=(this.player.dirX*Math.cos(-Math.PI/
2)-this.player.dirY*Math.sin(-Math.PI/2))*this.movSpeed,0==this.map[Math.floor(this.player.posX-a*this.player.collision)][Math.floor(this.player.posY)]&&(this.player.posX-=a),a=(this.player.dirX*Math.sin(-Math.PI/2)+this.player.dirY*Math.cos(-Math.PI/2))*this.movSpeed,0==this.map[Math.floor(this.player.posX)][Math.floor(this.player.posY-a*this.player.collision)]&&(this.player.posY-=a));this.player.backward&&(0==this.map[Math.floor(this.player.posX-this.player.dirX*this.movSpeed*this.player.collision)][Math.floor(this.player.posY)]&&
(this.player.posX-=this.player.dirX*this.movSpeed),0==this.map[Math.floor(this.player.posX)][Math.floor(this.player.posY-this.player.dirY*this.movSpeed*this.player.collision)]&&(this.player.posY-=this.player.dirY*this.movSpeed));this.oldTime=b}render(){if(this.workers.filter(b=>1==b.done).length==this.threads){this.ctx.drawImage(this.backBufferCanv,0,0);this.backBufferCtx.fillStyle="#777777";this.backBufferCtx.fillRect(0,0,this.canv.width,this.canv.height/2);this.backBufferCtx.fillStyle="#bbbbbb";
this.backBufferCtx.fillRect(0,this.canv.height/2,this.canv.width,this.canv.height);for(let b=0;b<this.workers.length;b++)this.workers[b].done=!1,this.workers[b].worker.postMessage({start:b,width:this.canv.width,height:this.canv.height,threads:this.threads,map:this.map,player:this.player,textures:this.textures,texWidth:64})}}}var module$src$modules$engine={};module$src$modules$engine.Engine=Engine$$module$src$modules$engine;const game$$module$src$app=new Engine$$module$src$modules$engine,gameStep$$module$src$app=function(b){game$$module$src$app.update(b);game$$module$src$app.render();window.requestAnimationFrame(gameStep$$module$src$app)};game$$module$src$app.init().then(()=>{window.requestAnimationFrame(gameStep$$module$src$app)});var module$src$app={};
