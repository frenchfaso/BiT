'use strict';class a{constructor(){this.H;this.i;this.j;this.a;this.b;this.B;this.C;this.s;this.u;this.G;this.w;this.A;this.I;this.c;this.lineHeight;this.F;this.D;this.v=this.f=this.L=this.o=0}};class q{constructor(){this.g=11;this.h=5;this.l=-1;this.J=this.m=0;this.K=.66;this.b=0;this.i=this.f=this.c=this.a=!1}};class r{constructor(){this.data=[[8,8,8,8,8,8,8,8,8,8,8,4,4,6,4,4,6,4,6,4,4,4,6,4],[8,0,0,0,0,0,0,0,0,0,8,4,0,0,0,0,0,0,0,0,0,0,0,4],[8,0,3,3,0,0,0,0,0,8,8,4,0,0,0,0,0,0,0,0,0,0,0,6],[8,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6],[8,0,3,3,0,0,0,0,0,8,8,4,0,0,0,0,0,0,0,0,0,0,0,4],[8,0,0,0,0,0,0,0,0,0,8,4,0,0,0,0,0,6,6,6,0,6,4,6],[8,8,8,8,0,8,8,8,8,8,8,4,4,4,4,4,4,6,0,0,0,0,0,6],[7,7,7,7,0,7,7,7,7,0,8,0,8,0,8,0,8,4,0,4,0,6,0,6],[7,7,0,0,0,0,0,0,7,8,0,8,0,8,0,8,8,6,0,0,0,0,0,6],[7,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,8,6,0,0,0,0,0,4],[7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,6,0,6,0,6,0,6],[7,7,0,0,0,0,0,0,7,8,0,8,0,8,0,8,8,6,4,6,0,6,6,6],[7,7,7,7,0,7,7,7,7,8,8,4,0,6,8,4,8,3,3,3,0,3,3,3],[2,2,2,2,0,2,2,2,2,4,6,4,0,0,6,0,6,3,0,0,0,0,0,3],[2,2,0,0,0,0,0,2,2,4,0,0,0,0,0,0,4,3,0,0,0,0,0,3],[2,0,0,0,0,0,0,0,2,4,0,0,0,0,0,0,4,3,0,0,0,0,0,3],[1,0,0,0,0,0,0,0,1,4,4,4,4,4,6,0,6,3,3,0,0,0,3,3],[2,0,0,0,0,0,0,0,2,2,2,1,2,2,2,6,6,0,0,5,0,5,0,5],[2,2,0,0,0,0,0,2,2,2,0,0,0,2,2,0,5,0,5,0,0,0,5,5],[2,0,0,0,0,0,0,0,2,0,
0,0,0,0,2,5,0,5,0,5,0,5,0,5],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5],[2,0,0,0,0,0,0,0,2,0,0,0,0,0,2,5,0,5,0,5,0,5,0,5],[2,2,0,0,0,0,0,2,2,2,0,0,0,2,2,0,5,0,5,0,0,0,5,5],[2,2,2,2,1,2,2,2,2,2,2,1,2,2,2,5,5,5,5,5,5,5,5,5]]}get a(){return this.data}};class t{constructor(){this.v=this.v.bind(this);this.I=new a;this.a=new q;this.i=(new r).a;this.w=[];this.G=new Image;this.b=document.createElement("canvas");this.b.width=window.innerWidth/2;this.b.height=window.innerHeight/2;this.b.style.a="pixelated";this.b.style.width="100%";this.f=document.createElement("canvas");this.f.width=this.b.width;this.f.height=this.b.height;this.o=this.f.getContext("2d");this.o.imageSmoothingEnabled=!1;this.f.style.a="pixelated";this.b.addEventListener("touchend",()=>
{this.s=!1;this.u=this.A=this.D=this.C=0;this.a.b=0;this.a.a=!1;this.a.c=!1});this.b.addEventListener("touchmove",b=>{this.s&&(this.A=-.1*(this.C-b.touches[0].clientX),this.u=this.D-b.touches[0].clientY,0!=this.u&&(this.a.a=!0))},{passive:!1});this.b.addEventListener("touchstart",b=>{this.s=!0;this.C=b.touches[0].clientX;this.D=b.touches[0].clientY},{passive:!1});document.body.appendChild(this.b);this.b.addEventListener("click",()=>{this.b.requestPointerLock()});this.j=this.b.getContext("2d",{alpha:!1});
this.j.imageSmoothingEnabled=!1;this.B=this.H=0;this.s=!1;this.c=this.u=this.A=this.D=this.C=0;this.F=1;document.addEventListener("pointerlockchange",()=>{document.pointerLockElement==this.b?document.addEventListener("mousemove",this.v,!1):document.removeEventListener("mousemove",this.v,!1)},!1);document.addEventListener("keyup",b=>{switch(b.keyCode){case 87:this.a.a=!1;break;case 83:this.a.c=!1;break;case 65:this.a.f=!1;break;case 68:this.a.i=!1;break;case 16:this.F=1}},!1);document.addEventListener("keydown",
b=>{switch(b.keyCode){case 87:this.a.a=!0;break;case 83:this.a.c=!0;break;case 65:this.a.f=!0;break;case 68:this.a.i=!0;break;case 16:this.F=2.5}},!1);document.getElementById("fullscreen").addEventListener("click",()=>{this.b.requestFullscreen&&this.b.requestFullscreen()});window.addEventListener("resize",()=>{this.b.width=window.innerWidth/2;this.b.height=window.innerHeight/2;this.f.width=this.b.width;this.f.height=this.b.height;this.j.imageSmoothingEnabled=!1;this.o.imageSmoothingEnabled=!1})}v(b){this.a.b=
b.movementX}};const u=new t;
function v(b){var c=(b-u.H)/1E3;u.c=2*c*u.F;if(1==u.s||u.a.b!=u.B){if(u.s){var e=u.A;u.c=u.u/1E3}else e=(u.B+u.a.b)/2;u.B=u.a.b;c=e*c*-.1;e=u.a.l;u.a.l=u.a.l*Math.cos(c)-u.a.m*Math.sin(c);u.a.m=e*Math.sin(c)+u.a.m*Math.cos(c);e=u.a.J;u.a.J=u.a.J*Math.cos(c)-u.a.K*Math.sin(c);u.a.K=e*Math.sin(c)+u.a.K*Math.cos(c)}u.a.a&&(0==u.i[Math.floor(u.a.g+u.a.l*u.c*15)][Math.floor(u.a.h)]&&(u.a.g+=u.a.l*u.c),0==u.i[Math.floor(u.a.g)][Math.floor(u.a.h+u.a.m*u.c*15)]&&(u.a.h+=u.a.m*u.c));u.a.i&&(c=(u.a.l*Math.cos(Math.PI/
2)-u.a.m*Math.sin(Math.PI/2))*u.c,0==u.i[Math.floor(u.a.g-15*c)][Math.floor(u.a.h)]&&(u.a.g-=c),c=(u.a.l*Math.sin(Math.PI/2)+u.a.m*Math.cos(Math.PI/2))*u.c,0==u.i[Math.floor(u.a.g)][Math.floor(u.a.h-15*c)]&&(u.a.h-=c));u.a.f&&(c=(u.a.l*Math.cos(-Math.PI/2)-u.a.m*Math.sin(-Math.PI/2))*u.c,0==u.i[Math.floor(u.a.g-15*c)][Math.floor(u.a.h)]&&(u.a.g-=c),c=(u.a.l*Math.sin(-Math.PI/2)+u.a.m*Math.cos(-Math.PI/2))*u.c,0==u.i[Math.floor(u.a.g)][Math.floor(u.a.h-15*c)]&&(u.a.h-=c));u.a.c&&(0==u.i[Math.floor(u.a.g-
u.a.l*u.c*15)][Math.floor(u.a.h)]&&(u.a.g-=u.a.l*u.c),0==u.i[Math.floor(u.a.g)][Math.floor(u.a.h-u.a.m*u.c*15)]&&(u.a.h-=u.a.m*u.c));u.H=b;{u.j.fillStyle="#777777";u.j.fillRect(0,0,u.b.width,u.b.height/2);u.j.fillStyle="#bbbbbb";u.j.fillRect(0,u.b.height/2,u.b.width,u.b.height);const p=u.o.getImageData(0,0,u.f.width,u.f.height);b=u.I;c=p.width;e=u.i;var d=u.a,f=u.b,k=u.w,g=p.data;for(let m=0;m<c;m++){b.I=0;b.H=2*m/f.width-1;b.i=d.l+d.J*b.H;b.j=d.m+d.K*b.H;b.a=Math.floor(d.g);b.b=Math.floor(d.h);b.B=
Math.abs(1/b.i);b.C=Math.abs(1/b.j);0>b.i?(b.w=-1,b.s=(d.g-b.a)*b.B):(b.w=1,b.s=(b.a+1-d.g)*b.B);0>b.j?(b.A=-1,b.u=(d.h-b.b)*b.C):(b.A=1,b.u=(b.b+1-d.h)*b.C);for(;0==b.I;)b.s<b.u?(b.s+=b.B,b.a+=b.w,b.c=0):(b.u+=b.C,b.b+=b.A,b.c=1),0<e[b.a][b.b]&&(b.I=1);b.G=0==b.c?(b.a-d.g+(1-b.w)/2)/b.i:(b.b-d.h+(1-b.A)/2)/b.j;b.lineHeight=Math.floor(f.height/b.G);b.F=Math.floor(-b.lineHeight/2+f.height/2);0>b.F&&(b.F=0);b.D=Math.floor(b.lineHeight/2+f.height/2);b.D>=f.height&&(b.D=f.height-1);b.f=e[b.a][b.b]-1;
b.v=0==b.c?d.h+b.G*b.j:d.g+b.G*b.i;b.v-=Math.floor(b.v);b.o=Math.floor(64*b.v);0==b.c&&0<b.i&&(b.o=64-b.o-1);1==b.c&&0>b.j&&(b.o=64-b.o-1);for(let n=b.F+1;n<b.D;n++){b.L=Math.floor(64*(256*n-128*f.height+128*b.lineHeight)/b.lineHeight/256);const h=4*(m+n*f.width),l=4*(b.o+64*b.L);1==b.c?(g[h]=k[b.f].data[l],g[h+1]=k[b.f].data[l+1],g[h+2]=k[b.f].data[l+2]):(g[h]=k[b.f+9].data[l],g[h+1]=k[b.f+9].data[l+1],g[h+2]=k[b.f+9].data[l+2]);g[h+3]=255}}u.o.putImageData(p,0,0);u.j.drawImage(u.f,0,0);u.o.clearRect(0,
0,u.f.width,u.f.height)}window.requestAnimationFrame(v)}
(async function(){return new Promise(b=>{u.G.addEventListener("load",async()=>{const c=document.createElement("canvas");c.width=64;c.height=64;const e=c.getContext("2d");for(let d=0;9>d;d++)e.drawImage(u.G,d%3*64,64*Math.floor(d/3),64,64,0,0,c.width,c.height),u.w[d]=e.getImageData(0,0,c.width,c.height),e.fillStyle="rgba(0,0,0,0.35)",e.fillRect(0,0,c.width,c.height),u.w[d+9]=e.getImageData(0,0,c.width,c.height);b()});u.G.src="./textures.webp"})})().then(()=>{window.requestAnimationFrame(v)});
