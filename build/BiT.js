'use strict';class a{constructor(){this.b=11;this.f=5;this.g=-1;this.u=this.h=0;this.v=.66;this.l=0;this.s=this.o=this.m=this.i=!1}};class g{constructor(){this.data=[[8,8,8,8,8,8,8,8,8,8,8,4,4,6,4,4,6,4,6,4,4,4,6,4],[8,0,0,0,0,0,0,0,0,0,8,4,0,0,0,0,0,0,0,0,0,0,0,4],[8,0,3,3,0,0,0,0,0,8,8,4,0,0,0,0,0,0,0,0,0,0,0,6],[8,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6],[8,0,3,3,0,0,0,0,0,8,8,4,0,0,0,0,0,0,0,0,0,0,0,4],[8,0,0,0,0,0,0,0,0,0,8,4,0,0,0,0,0,6,6,6,0,6,4,6],[8,8,8,8,0,8,8,8,8,8,8,4,4,4,4,4,4,6,0,0,0,0,0,6],[7,7,7,7,0,7,7,7,7,0,8,0,8,0,8,0,8,4,0,4,0,6,0,6],[7,7,0,0,0,0,0,0,7,8,0,8,0,8,0,8,8,6,0,0,0,0,0,6],[7,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,8,6,0,0,0,0,0,4],[7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,6,0,6,0,6,0,6],[7,7,0,0,0,0,0,0,7,8,0,8,0,8,0,8,8,6,4,6,0,6,6,6],[7,7,7,7,0,7,7,7,7,8,8,4,0,6,8,4,8,3,3,3,0,3,3,3],[2,2,2,2,0,2,2,2,2,4,6,4,0,0,6,0,6,3,0,0,0,0,0,3],[2,2,0,0,0,0,0,2,2,4,0,0,0,0,0,0,4,3,0,0,0,0,0,3],[2,0,0,0,0,0,0,0,2,4,0,0,0,0,0,0,4,3,0,0,0,0,0,3],[1,0,0,0,0,0,0,0,1,4,4,4,4,4,6,0,6,3,3,0,0,0,3,3],[2,0,0,0,0,0,0,0,2,2,2,1,2,2,2,6,6,0,0,5,0,5,0,5],[2,2,0,0,0,0,0,2,2,2,0,0,0,2,2,0,5,0,5,0,0,0,5,5],[2,0,0,0,0,0,0,0,2,0,
0,0,0,0,2,5,0,5,0,5,0,5,0,5],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5],[2,0,0,0,0,0,0,0,2,0,0,0,0,0,2,5,0,5,0,5,0,5,0,5],[2,2,0,0,0,0,0,2,2,2,0,0,0,2,2,0,5,0,5,0,0,0,5,5],[2,2,2,2,1,2,2,2,2,2,2,1,2,2,2,5,5,5,5,5,5,5,5,5]]}get map(){return this.data}};class h{constructor(){this.i=this.i.bind(this);this.B=2;this.f=[];this.a=new a;this.a.dirX=this.a.g;this.a.dirY=this.a.h;this.map=(new g).map;this.w=[];this.u=new Image;this.c=document.createElement("canvas");this.c.width=window.innerWidth;this.c.height=window.innerHeight;this.c.style.b="pixelated";this.c.style.width="100vw";for(let c=0;c<this.B;c++){const b=new Worker("./raycaster.js");b.onmessage=f=>{f=new ImageData(new Uint8ClampedArray(f.data),this.c.width,this.c.height);this.f[c].j.putImageData(f,
0,0)};const d=document.createElement("canvas");d.width=this.c.width;d.height=this.c.height;d.style.b="pixelated";const e=d.getContext("2d");e.imageSmoothingEnabled=!1;this.f[c]={C:b,c:d,j:e}}this.c.addEventListener("touchend",()=>{this.g=!1;this.h=this.v=this.o=this.m=0;this.a.l=0;this.a.i=!1;this.a.m=!1});this.c.addEventListener("touchmove",c=>{this.g&&(this.v=-.1*(this.m-c.touches[0].clientX),this.h=this.o-c.touches[0].clientY,0!=this.h&&(this.a.i=!0))},{passive:!1});this.c.addEventListener("touchstart",
c=>{this.g=!0;this.m=c.touches[0].clientX;this.o=c.touches[0].clientY},{passive:!1});document.body.appendChild(this.c);this.c.addEventListener("click",()=>{this.c.requestPointerLock()});this.j=this.c.getContext("2d",{alpha:!1});this.j.imageSmoothingEnabled=!1;this.l=this.A=0;this.g=!1;this.b=this.h=this.v=this.o=this.m=0;this.s=1;document.addEventListener("pointerlockchange",()=>{document.pointerLockElement==this.c?document.addEventListener("mousemove",this.i,!1):document.removeEventListener("mousemove",
this.i,!1)},!1);document.addEventListener("keyup",c=>{switch(c.keyCode){case 87:this.a.i=!1;break;case 83:this.a.m=!1;break;case 65:this.a.o=!1;break;case 68:this.a.s=!1;break;case 16:this.s=1}},!1);document.addEventListener("keydown",c=>{switch(c.keyCode){case 87:this.a.i=!0;break;case 83:this.a.m=!0;break;case 65:this.a.o=!0;break;case 68:this.a.s=!0;break;case 16:this.s=2.5}},!1);document.getElementById("fullscreen").addEventListener("click",()=>{this.c.requestFullscreen&&this.c.requestFullscreen()});
window.addEventListener("resize",()=>{this.j.imageSmoothingEnabled=!1})}i(c){this.a.l=c.movementX}};const k=new h;
function l(c){var b=(c-k.A)/1E3;k.b=2*b*k.s;if(1==k.g||k.a.l!=k.l){if(k.g){var d=k.v;k.b=k.h/1E3}else d=(k.l+k.a.l)/2;k.l=k.a.l;b=d*b*-.1;d=k.a.g;k.a.g=k.a.g*Math.cos(b)-k.a.h*Math.sin(b);k.a.h=d*Math.sin(b)+k.a.h*Math.cos(b);d=k.a.u;k.a.u=k.a.u*Math.cos(b)-k.a.v*Math.sin(b);k.a.v=d*Math.sin(b)+k.a.v*Math.cos(b)}k.a.i&&(0==k.map[Math.floor(k.a.b+k.a.g*k.b*15)][Math.floor(k.a.f)]&&(k.a.b+=k.a.g*k.b),0==k.map[Math.floor(k.a.b)][Math.floor(k.a.f+k.a.h*k.b*15)]&&(k.a.f+=k.a.h*k.b));k.a.s&&(b=(k.a.g*Math.cos(Math.PI/
2)-k.a.h*Math.sin(Math.PI/2))*k.b,0==k.map[Math.floor(k.a.b-15*b)][Math.floor(k.a.f)]&&(k.a.b-=b),b=(k.a.g*Math.sin(Math.PI/2)+k.a.h*Math.cos(Math.PI/2))*k.b,0==k.map[Math.floor(k.a.b)][Math.floor(k.a.f-15*b)]&&(k.a.f-=b));k.a.o&&(b=(k.a.g*Math.cos(-Math.PI/2)-k.a.h*Math.sin(-Math.PI/2))*k.b,0==k.map[Math.floor(k.a.b-15*b)][Math.floor(k.a.f)]&&(k.a.b-=b),b=(k.a.g*Math.sin(-Math.PI/2)+k.a.h*Math.cos(-Math.PI/2))*k.b,0==k.map[Math.floor(k.a.b)][Math.floor(k.a.f-15*b)]&&(k.a.f-=b));k.a.m&&(0==k.map[Math.floor(k.a.b-
k.a.g*k.b*15)][Math.floor(k.a.f)]&&(k.a.b-=k.a.g*k.b),0==k.map[Math.floor(k.a.b)][Math.floor(k.a.f-k.a.h*k.b*15)]&&(k.a.f-=k.a.h*k.b));k.A=c;for(c=0;c<k.f.length;c++)k.f[c].C.postMessage({start:c,end:k.c.width,width:k.c.width,height:k.c.height,B:k.f.length,map:k.map,a:k.a,w:k.w,D:64});k.j.fillStyle="#777777";k.j.fillRect(0,0,k.c.width,k.c.height/2);k.j.fillStyle="#bbbbbb";k.j.fillRect(0,k.c.height/2,k.c.width,k.c.height);for(c=0;c<k.f.length;c++)k.j.drawImage(k.f[c].c,0,0);window.requestAnimationFrame(l)}
(async function(){return new Promise(c=>{k.u.addEventListener("load",async()=>{const b=document.createElement("canvas");b.width=64;b.height=64;const d=b.getContext("2d");for(let e=0;9>e;e++)d.drawImage(k.u,e%3*64,64*Math.floor(e/3),64,64,0,0,b.width,b.height),k.w[e]=d.getImageData(0,0,b.width,b.height),d.fillStyle="rgba(0,0,0,0.35)",d.fillRect(0,0,b.width,b.height),k.w[e+9]=d.getImageData(0,0,b.width,b.height);c()});k.u.src="./textures.webp"})})().then(()=>{window.requestAnimationFrame(l)});
